<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .infor {
            width: 100%;
            height: 100%;
            color: black;
            font-size: 28px;
            font-family: Inter;
            font-weight: 400;
            word-wrap: break-word;
        }

        .infor-2 {
            color: black;
            font-size: 22px;
            font-family: Inter;
            font-weight: 300;
            word-wrap: break-word;
        }

        .infor-3 {
            color: rgba(0, 0, 0, 0.63);
            font-size: 20px;
            font-family: Inter;
            font-weight: 400;
            word-wrap: break-word
        }

        .picture {
            border-radius: 20px;
        }
    </style>

</head>
<body class="body">
<div class="container">
    <div style="margin-left: 20px; margin-top: 20px">
        <a role="button" class="btn btn-primary" th:href="@{/tour/view/1}">Quay lại</a>
    </div>
    <form th:object="${tourDto}">
        <input type="hidden" th:field="*{adultPrice}" id="priceAdult">
        <input type="hidden" th:field="*{childPrice}" id="priceChildren">
        <input type="hidden" th:field="*{id}" id="tourId">
    </form>
    <form th:object="${bookingDto}" action="/booking/add" method="post">
        <div class="row">
            <div class="col-lg-6">
                <div style="margin:20px 20px;">
                    <div style="border: #c4c2c2; border-width: 1px; border-style: solid; border-radius: 20px">
                        <div style="margin: 20px 20px 0 20px">
                            <div style="display: flex">
                                <div class="infor">
                                    Giá tốt.
                                </div>
                                <div>
                                    <img style="width: 50px; height: 50px"
                                         src="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcQ682oMkL-I8vHb9txmoo_J4yniLQ-fSaFoSkM70dLCMBF5j6cu"/>
                                </div>
                            </div>
                            <div style="color: #696363; font-size: 20px; font-family: Inter; font-weight: 400; word-wrap: break-word">
                                Ưu đãi dành cho bạn. Nhập mã để nhận ngay ưu đãi
                            </div>
                            <div style="margin-top: 20px; margin-bottom: 20px; color: #FF3B5F; font-size: 23px; font-family: Inter; font-weight: 400; word-wrap: break-word">
                                #ABCD
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px">
                        <div>
                            <div class="infor">
                                Thông tin chuyến đi của bạn
                            </div>
                            <div>
                                <div style="margin: 10px 0 20px 30px">
                                    <div class="infor-2">
                                        Thời gian
                                    </div>
                                    <div style="color: rgba(0, 0, 0, 0.63); font-size: 20px; font-family: Inter; font-weight: 400; word-wrap: break-word">
                                        <div th:text="${tourDto.startDate}+' - '+${tourDto.endDate}">
                                            Ngày khởi hành - Ngày kết thúc
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div style="margin: 20px 0 20px 30px">
                                    <input type="hidden" th:field="*{tourId}">
                                    <div class="mb-3">
                                        <label for="adultQuantity" class="form-label infor-2">
                                            Số lượng người lớn</label>
                                        <input type="text" class="form-control" id="adultQuantity"
                                               placeholder="Nhập số lượng" th:field="*{adultQuantity}">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div style="margin: 20px 0 20px 30px">
                                    <div class="mb-3">
                                        <label for="childrenQuantity" class="form-label infor-2">Số
                                            lượng trẻ em</label>
                                        <input type="text" class="form-control" id="childrenQuantity"
                                               placeholder="Nhập số lượng" th:field="*{childrenQuantity}">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div style="margin: 20px 0 20px 30px">
                                    <div class="mb-3">
                                        <label for="exampleInputPassword3" class="form-label">
                                            <div class="infor-2">Mã giảm giá</div>
                                        </label>
                                        <input type="text" class="form-control" id="exampleInputPassword3"
                                               placeholder="Nhập mã giảm giá (nếu có)"
                                               th:field="*{promotionCode}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-4">
                        <div>
                            <div class="infor">
                                Thông tin liên hệ
                            </div>
                            <div style="margin-left: 30px; margin-top: 15px">
                                <div class="mb-3">
                                    <label for="exampleInputEmail1" class="form-label">
                                        <div class="infor-2">Họ và tên</div>
                                    </label>
                                    <input type="text" class="form-control" id="exampleInputEmail1" th:field="*{name}"
                                           placeholder="Nhập họ và tên" required>
                                </div>
                                <span style="color: red" th:if="${#fields.hasErrors('name')}"
                                      th:errors="*{name}"></span>
                                <div class="mb-3">
                                    <label for="exampleInputPassword1" class="form-label">
                                        <div class="infor-2">Email</div>
                                    </label>
                                    <input type="email" class="form-control" id="exampleInputPassword1"
                                           th:field="*{email}"
                                           placeholder="Nhập email" required>
                                </div>
                                <div class="mb-3">
                                    <label for="exampleInputPassword2" class="form-label">
                                        <div class="infor-2">Số điện thoại</div>
                                    </label>
                                    <input type="number" class="form-control" id="exampleInputPassword2"
                                           th:field="*{phone}"
                                           placeholder="Nhập số điện thoại" required>
                                    <span style="color: red" th:if="${#fields.hasErrors('phone')}"
                                          th:errors="*{phone}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="col-lg-6">
                <div style="margin-top:20px; width: 100%; height: 620px; background: white; border-radius: 29px; border: 1px #C7C2C2 solid; backdrop-filter: blur(4px)">
                    <div style="display: flex; margin: 20px 20px;">
                        <img class="picture" style="width: 280px; height:auto"
                             th:src="${tourDto.getTourImage()}">
                        <div style="margin: 20px 20px">
                            <h3 style="font-weight: bold" class="infor" th:text="${tourDto.tourName}"> </h3>
                        </div>
                    </div>
                    <hr class="mx-3">
                    <div style="margin: 20px 20px">
                        <div class="infor">
                            Chi tiết thanh toán
                        </div>
                        <div>
                            <div>
                                <div style="display: flex;margin: 10px 0 20px 30px">
                                    <div class="infor-2">
                                        Tổng giá vé người lớn
                                    </div>
                                    <div class="ms-5">
                                        <h3 id="totalAdult"></h3>
                                    </div>
                                </div>
                                <div style="display: flex;margin: 10px 0 20px 30px">
                                    <div class="infor-2">
                                        Tổng giá vé người lớn
                                    </div>
                                    <div class="ms-5">
                                        <h3 id="totalChildren"></h3>
                                    </div>
                                </div>
                                <div style="display: flex;margin: 10px 0 20px 30px">
                                    <div class="infor-2">
                                        Giảm giá
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="mx-3">
                    <div style="display: flex;margin: 20px 20px">
                        <div class="infor" style="width: 300px">
                            Thành tiền
                        </div>
                        <div>
                            <h3 id="total"></h3>
                        </div>
                    </div>
                    <div>
                        <input th:if="${link==null}" style="width: 90%;color: white; font-size: 30px; font-weight: bold; margin-left: 26px" class="btn btn-primary" type="submit" id="pay" value="Đặt tour">
                        <a role="button" style="width: 90%; margin-left: 26px; color: white; font-size: 30px; font-weight: bold; background: #f37d34" class="btn" th:if="${link!=null}" th:href="@{${link}}">Thanh toán</a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        let priceAdult;
        let priceChildren;
        let adultQuantity;
        let childrenQuantity;
        let totalAdult = 0;
        let totalChildren = 0;
        let total;
        $("input").click(function () {
            priceAdult = $("#priceAdult").val();
            priceChildren = $("#priceChildren").val();
            adultQuantity = $("#adultQuantity").val();
            childrenQuantity = $("#childrenQuantity").val();
            totalAdult = priceAdult * adultQuantity;
            totalChildren = priceChildren * childrenQuantity;
            total = totalAdult * 1 + totalChildren * 1;
            console.log(totalAdult);
            document.getElementById("totalAdult").innerText = totalAdult + " đ";
            document.getElementById("totalChildren").innerText = totalChildren + " đ";
            document.getElementById("total").innerText = total +" đ";
        })

        // $("#pay").click(function (e) {
        //     e.preventDefault();
        //     let name = $("#exampleInputEmail1").val();
        //     let email = $("#exampleInputPassword1").val();
        //     let phone = $("#exampleInputPassword2").val();
        //     let emailRegx=/^\S+@\S+\.\S+$/;
        //     let nameRegx = /^[a-zA-z ]+$/;
        //     let phoneRegx = /(84|0[3|5|7|8|9])+([0-9]{8})\b/;
        //     let isValid = true;
        //     console.log(phoneRegx.test(phone))
        //     if (!nameRegx.test(name)) {
        //         isValid = false;
        //         // $("#name-error").text("Tên không hợp lệ");
        //     }
        //
        //     if (!emailRegx.test(email)) {
        //         isValid = false;
        //         // $("#email-error").text("Email không hợp lệ");
        //     }
        //
        //     if (!phoneRegx.test(phone)) {
        //         isValid = false;
        //         // $("#phone-error").text("Số điện thoại không hợp lệ");
        //     }
        //     if (isValid) {
        //         $.ajax({
        //             url: `http://localhost:8080/api/vnpay?price=${total}`,
        //             method: 'GET',
        //             data: 'json',
        //             success: function (data) {
        //                 console.log(data)
        //                 $("#pay").click(function () {
        //                     window.location.href = `${data}`;
        //                 });
        //             }
        //         })
        //     } else {
        //
        //     }
        // });
    })

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
</body>
</html>